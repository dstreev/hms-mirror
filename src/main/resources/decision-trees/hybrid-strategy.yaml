# HYBRID Data Strategy Decision Tree
# Purpose: Combines metadata and limited data movement for optimal migration balance

strategy: "HYBRID"
description: "Combines metadata and limited data movement for optimal migration balance"

pages:
  connections:
    title: "Connection Selection"
    description: "Select source and target cluster connections"
    nodes:
      - id: "left_connection"
        title: "LEFT Connection"
        description: "Select source cluster connection profile"
        type: "CONNECTION_SELECT"
        category: "connections"
        required: true
        nextNodeId: "right_connection"
        
      - id: "right_connection"
        title: "RIGHT Connection"
        description: "Select target cluster connection profile"
        type: "CONNECTION_SELECT"
        category: "connections"
        required: true
        nextPageId: "general_behavior"

  general_behavior:
    title: "General Behavior"
    description: "Configure basic migration behavior"
    nodes:
      - id: "database_only"
        title: "Database Only Migration"
        description: "Migrate only database definitions, skip tables"
        type: "BOOLEAN"
        category: "general"
        required: false
        nextNodeId: "copy_avro_schemas"
        
      - id: "copy_avro_schemas"
        title: "Copy AVRO Schema Files"
        description: "Copy AVRO schema files between clusters"
        type: "BOOLEAN"
        category: "general"
        required: false
        nextNodeId: "skip_link_check"
        
      - id: "skip_link_check"
        title: "Skip Link Check"
        description: "Skip cluster storage accessibility check"
        type: "BOOLEAN"
        category: "general"
        required: false
        nextPageId: "cluster_connectivity"

  cluster_connectivity:
    title: "Cluster Connectivity"
    description: "Configure storage connectivity between clusters"
    nodes:
      - id: "intermediate_storage"
        title: "Intermediate Storage"
        description: "Shared storage location accessible by both clusters for data transit"
        type: "TEXT_INPUT"
        category: "connectivity"
        required: false
        dependencies: ["skip_link_check"]
        validationRules:
          conditionalRequired: "skip_link_check == true"
        nextPageId: "migration_type"

  migration_type:
    title: "Migration Type Selection"
    description: "Select which types of tables to migrate"
    nodes:
      - id: "acid_migration"
        title: "ACID Tables Migration"
        description: "Configure ACID table migration (Metadata Only)"
        type: "SINGLE_SELECT"
        category: "migration"
        required: true
        options:
          - value: "none"
            label: "Skip ACID Tables"
            description: "Do not migrate ACID tables"
          - value: "include"
            label: "Include ACID Tables"
            description: "Include ACID tables metadata with other tables"
            recommended: true
          - value: "only"
            label: "ACID Tables Only"
            description: "Migrate ONLY ACID tables metadata"
        nextNodeId: "acid_options"
        
      - id: "acid_options"
        title: "ACID Table Options"
        description: "Configure ACID table specific settings"
        type: "PAGE_TRANSITION"
        category: "migration"
        dependencies: ["acid_migration"]
        conditionalLogic: "acid_migration != 'none'"
        nextNodeId: "acid_bucket_threshold"
        
      - id: "acid_bucket_threshold"
        title: "Artificial Bucket Threshold"
        description: "Remove bucket definitions if count â‰¤ threshold (Default: 2)"
        type: "NUMBER_INPUT"
        category: "migration"
        required: false
        metadata:
          defaultValue: 2
          min: 1
          max: 100
        nextNodeId: "acid_partition_limit"
        
      - id: "acid_partition_limit"
        title: "ACID Partition Limit"
        description: "Skip ACID tables exceeding this partition count (Default: 500)"
        type: "NUMBER_INPUT"
        category: "migration"
        required: false
        metadata:
          defaultValue: 500
          min: 1
          max: 10000
        nextNodeId: "acid_downgrade"
        
      - id: "acid_downgrade"
        title: "Downgrade ACID Tables"
        description: "Convert ACID to EXTERNAL/PURGE tables"
        type: "BOOLEAN"
        category: "migration"
        required: false
        nextNodeId: "acid_inplace"
        
      - id: "acid_inplace"
        title: "In-place ACID Downgrade"
        description: "Downgrade on same cluster"
        type: "BOOLEAN"
        category: "migration"
        required: false
        dependencies: ["acid_downgrade"]
        conditionalLogic: "acid_downgrade == true"
        nextNodeId: "migrate_views"
        
      - id: "migrate_views"
        title: "Migrate Views"
        description: "Migrate views after underlying tables exist"
        type: "BOOLEAN"
        category: "migration"
        required: false
        nextNodeId: "migrate_non_native"
        
      - id: "migrate_non_native"
        title: "Migrate Non-Native Tables"
        description: "Migrate HBase, Kafka, JDBC tables"
        type: "BOOLEAN"
        category: "migration"
        required: false
        nextPageId: "data_movement"

  data_movement:
    title: "Data Movement Configuration"
    description: "Configure data movement strategy for HYBRID approach"
    nodes:
      - id: "export_import_enable"
        title: "Enable Export/Import"
        description: "Use Hive export/import for data movement"
        type: "BOOLEAN"
        category: "data_movement"
        required: false
        nextNodeId: "export_import_options"
        
      - id: "export_import_options"
        title: "Export/Import Options"
        description: "Configure export/import specific settings"
        type: "PAGE_TRANSITION"
        category: "data_movement"
        dependencies: ["export_import_enable"]
        conditionalLogic: "export_import_enable == true"
        nextNodeId: "export_batch_size"
        
      - id: "export_batch_size"
        title: "Export Batch Size"
        description: "Number of partitions to process in parallel (Default: 4)"
        type: "NUMBER_INPUT"
        category: "data_movement"
        required: false
        metadata:
          defaultValue: 4
          min: 1
          max: 50
        nextNodeId: "import_batch_size"
        
      - id: "import_batch_size"
        title: "Import Batch Size"
        description: "Number of import operations to process in parallel (Default: 4)"
        type: "NUMBER_INPUT"
        category: "data_movement"
        required: false
        metadata:
          defaultValue: 4
          min: 1
          max: 50
        nextNodeId: "distcp_enable"
        
      - id: "distcp_enable"
        title: "Enable DistCP"
        description: "Use Hadoop DistCP for large data files"
        type: "BOOLEAN"
        category: "data_movement"
        required: false
        nextNodeId: "distcp_options"
        
      - id: "distcp_options"
        title: "DistCP Options"
        description: "Configure DistCP specific settings"
        type: "PAGE_TRANSITION"
        category: "data_movement"
        dependencies: ["distcp_enable"]
        conditionalLogic: "distcp_enable == true"
        nextNodeId: "distcp_flow"
        
      - id: "distcp_flow"
        title: "DistCP Flow Control"
        description: "DistCP execution flow strategy"
        type: "SINGLE_SELECT"
        category: "data_movement"
        required: false
        options:
          - value: "auto"
            label: "Auto"
            description: "Automatic flow control based on data size"
            recommended: true
          - value: "push"
            label: "Push"
            description: "Push data from source to target"
          - value: "pull"
            label: "Pull"
            description: "Pull data from source to target"
        nextPageId: "location_translation"

  location_translation:
    title: "Location Translation Strategy"
    description: "Configure how table locations are translated"
    nodes:
      - id: "translation_type"
        title: "Translation Type"
        description: "Select location translation strategy"
        type: "SINGLE_SELECT"
        category: "location"
        required: true
        options:
          - value: "RELATIVE"
            label: "Relative"
            description: "Simple namespace replacement"
          - value: "ALIGNED"
            label: "Aligned"
            description: "Use warehouse plans for organized layout"
            recommended: true
        nextNodeId: "target_namespace"
        
      - id: "target_namespace"
        title: "Target Namespace"
        description: "Target storage namespace"
        type: "TEXT_INPUT"
        category: "location"
        required: true
        nextNodeId: "warehouse_config"
        
      - id: "warehouse_config"
        title: "Warehouse Configuration"
        description: "Configure warehouse settings for ALIGNED translation"
        type: "PAGE_TRANSITION"
        category: "location"
        dependencies: ["translation_type"]
        conditionalLogic: "translation_type == 'ALIGNED'"
        nextPageId: "optimization"

  optimization:
    title: "Optimization Settings"
    description: "Configure optimization settings for HYBRID strategy"
    nodes:
      - id: "optimization_approach"
        title: "Optimization Approach"
        description: "Select optimization strategy"
        type: "SINGLE_SELECT"
        category: "optimization"
        required: true
        options:
          - value: "autoTune"
            label: "Auto Tune (Recommended)"
            description: "Automatically optimize based on table characteristics"
            recommended: true
          - value: "skip"
            label: "Skip Optimizations"
            description: "No optimizations. Use when data is already well-organized."
        nextNodeId: "optimization_additional"
        
      - id: "optimization_additional"
        title: "Additional Optimization Settings"
        description: "Configure additional optimization options"
        type: "MULTI_SELECT"
        category: "optimization"
        required: false
        options:
          - value: "skipStatsCollection"
            label: "Skip Statistics Collection"
            description: "Skip filesystem statistics gathering. Use for slow storage like S3."
          - value: "buildShadowStatistics"
            label: "Build Shadow Statistics"
            description: "Build statistics on shadow/transfer tables"
          - value: "saveWorkingTables"
            label: "Save Working Tables"
            description: "Keep shadow/transfer tables after migration for debugging"
        nextPageId: "execution_mode"

  execution_mode:
    title: "Execution Mode"
    description: "Final execution settings"
    nodes:
      - id: "execution_type"
        title: "Execution Type"
        description: "Choose execution mode"
        type: "SINGLE_SELECT"
        category: "execution"
        required: true
        options:
          - value: "dryRun"
            label: "Dry Run"
            description: "Generate plans without executing (recommended first)"
            recommended: true
          - value: "execute"
            label: "Execute"
            description: "Execute the migration"
            warningMessage: "This will perform the actual migration. Ensure you have tested with dry run first."
        nextNodeId: "execution_options"
        
      - id: "execution_options"
        title: "Execution Options"
        description: "Additional execution settings"
        type: "MULTI_SELECT"
        category: "execution"
        required: false
        options:
          - value: "readOnly"
            label: "Read Only"
            description: "Create tables without PURGE flag"
          - value: "noPurge"
            label: "No Purge"
            description: "Force no PURGE flag"
          - value: "sync"
            label: "Synchronize"
            description: "Synchronize schemas (drop/recreate if different)"
          - value: "resetRight"
            label: "Reset Right"
            description: "DROP CASCADE databases on RIGHT first"
            warningMessage: "This will delete all existing databases on the target cluster!"
        nextNodeId: "complete"
        
      - id: "complete"
        title: "Configuration Complete"
        description: "HYBRID strategy configuration is complete"
        type: "PAGE_TRANSITION"
        category: "completion"