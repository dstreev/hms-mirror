# SCHEMA_ONLY Data Strategy Decision Tree
# Purpose: Migrate only metadata (schemas, tables, views) without data movement

strategy: "SCHEMA_ONLY"
description: "Migrate only metadata (schemas, tables, views) without data movement"

pages:
  connections:
    title: "Connection Selection"
    description: "Select source and target cluster connections"
    nodes:
      - id: "left_connection"
        title: "LEFT Connection"
        description: "Select source cluster connection profile"
        type: "CONNECTION_SELECT"
        category: "connections"
        required: true
        nextNodeId: "right_connection"
        
      - id: "right_connection"
        title: "RIGHT Connection"
        description: "Select target cluster connection profile"
        type: "CONNECTION_SELECT"
        category: "connections"
        required: true
        nextPageId: "general_behavior"

  general_behavior:
    title: "General Behavior"
    description: "Configure basic migration behavior"
    nodes:
      - id: "database_only"
        title: "Database Only Migration"
        description: "Migrate only database definitions, skip tables"
        type: "BOOLEAN"
        category: "general"
        required: false
        nextNodeId: "copy_avro_schemas"
        
      - id: "copy_avro_schemas"
        title: "Copy AVRO Schema Files"
        description: "Copy AVRO schema files between clusters"
        type: "BOOLEAN"
        category: "general"
        required: false
        nextPageId: "migration_type"

  migration_type:
    title: "Migration Type Selection"
    description: "Select which types of metadata to migrate"
    nodes:
      - id: "acid_migration"
        title: "ACID Tables Migration"
        description: "Configure ACID table migration (Metadata Only)"
        type: "SINGLE_SELECT"
        category: "migration"
        required: true
        options:
          - value: "none"
            label: "Skip ACID Tables"
            description: "Do not migrate ACID tables metadata"
          - value: "include"
            label: "Include ACID Tables"
            description: "Include ACID tables metadata with other tables"
            recommended: true
          - value: "only"
            label: "ACID Tables Only"
            description: "Migrate ONLY ACID tables metadata"
        nextNodeId: "acid_options"
        
      - id: "acid_options"
        title: "ACID Table Options"
        description: "Configure ACID table specific settings"
        type: "PAGE_TRANSITION"
        category: "migration"
        dependencies: ["acid_migration"]
        conditionalLogic: "acid_migration != 'none'"
        nextNodeId: "acid_bucket_threshold"
        
      - id: "acid_bucket_threshold"
        title: "Artificial Bucket Threshold"
        description: "Remove bucket definitions if count â‰¤ threshold (Default: 2)"
        type: "NUMBER_INPUT"
        category: "migration"
        required: false
        metadata:
          defaultValue: 2
          min: 1
          max: 100
        nextNodeId: "acid_partition_limit"
        
      - id: "acid_partition_limit"
        title: "ACID Partition Limit"
        description: "Skip ACID tables exceeding this partition count (Default: 500)"
        type: "NUMBER_INPUT"
        category: "migration"
        required: false
        metadata:
          defaultValue: 500
          min: 1
          max: 10000
        nextNodeId: "acid_downgrade"
        
      - id: "acid_downgrade"
        title: "Downgrade ACID Tables"
        description: "Convert ACID to EXTERNAL/PURGE tables in metadata"
        type: "BOOLEAN"
        category: "migration"
        required: false
        nextNodeId: "acid_inplace"
        
      - id: "acid_inplace"
        title: "In-place ACID Downgrade"
        description: "Downgrade on same cluster"
        type: "BOOLEAN"
        category: "migration"
        required: false
        dependencies: ["acid_downgrade"]
        conditionalLogic: "acid_downgrade == true"
        nextNodeId: "migrate_views"
        
      - id: "migrate_views"
        title: "Migrate Views"
        description: "Migrate view definitions"
        type: "BOOLEAN"
        category: "migration"
        required: false
        nextNodeId: "migrate_non_native"
        
      - id: "migrate_non_native"
        title: "Migrate Non-Native Tables"
        description: "Migrate HBase, Kafka, JDBC table metadata"
        type: "BOOLEAN"
        category: "migration"
        required: false
        nextPageId: "schema_transformation"

  schema_transformation:
    title: "Schema Transformation"
    description: "Configure schema and metadata transformations"
    nodes:
      - id: "table_type_conversion"
        title: "Table Type Conversion"
        description: "How to handle table type conversions"
        type: "SINGLE_SELECT"
        category: "transformation"
        required: true
        options:
          - value: "preserve"
            label: "Preserve Original"
            description: "Keep original table types unchanged"
            recommended: true
          - value: "external"
            label: "Convert to External"
            description: "Convert all tables to EXTERNAL type"
          - value: "external_purge"
            label: "Convert to External with PURGE"
            description: "Convert all tables to EXTERNAL with PURGE property"
        nextNodeId: "location_handling"
        
      - id: "location_handling"
        title: "Location Handling"
        description: "How to handle table location metadata"
        type: "SINGLE_SELECT"
        category: "transformation"
        required: true
        options:
          - value: "preserve"
            label: "Preserve Original Locations"
            description: "Keep original table location paths"
          - value: "translate"
            label: "Translate Locations"
            description: "Translate location paths for target cluster"
            recommended: true
          - value: "remove"
            label: "Remove Locations"
            description: "Create tables without specific location references"
        nextNodeId: "location_translation"
        
      - id: "location_translation"
        title: "Location Translation Configuration"
        description: "Configure location translation settings"
        type: "PAGE_TRANSITION"
        category: "transformation"
        dependencies: ["location_handling"]
        conditionalLogic: "location_handling == 'translate'"
        nextNodeId: "source_namespace"
        
      - id: "source_namespace"
        title: "Source Namespace"
        description: "Source storage namespace to translate from"
        type: "TEXT_INPUT"
        category: "transformation"
        required: false
        dependencies: ["location_handling"]
        conditionalLogic: "location_handling == 'translate'"
        nextNodeId: "target_namespace"
        
      - id: "target_namespace"
        title: "Target Namespace"
        description: "Target storage namespace to translate to"
        type: "TEXT_INPUT"
        category: "transformation"
        required: false
        dependencies: ["location_handling"]
        conditionalLogic: "location_handling == 'translate'"
        nextNodeId: "partition_handling"
        
      - id: "partition_handling"
        title: "Partition Metadata Handling"
        description: "How to handle partition metadata"
        type: "SINGLE_SELECT"
        category: "transformation"
        required: true
        options:
          - value: "include"
            label: "Include Partition Metadata"
            description: "Migrate partition definitions and metadata"
            recommended: true
          - value: "skip"
            label: "Skip Partitions"
            description: "Create tables without partition metadata"
          - value: "structure_only"
            label: "Structure Only"
            description: "Include partition columns but not specific partitions"
        nextPageId: "validation_options"

  validation_options:
    title: "Validation and Quality Checks"
    description: "Configure validation and quality assurance options"
    nodes:
      - id: "validate_schema"
        title: "Schema Validation"
        description: "Validate schema compatibility between source and target"
        type: "BOOLEAN"
        category: "validation"
        required: false
        nextNodeId: "validate_names"
        
      - id: "validate_names"
        title: "Name Validation"
        description: "Validate table and column names for target cluster compatibility"
        type: "BOOLEAN"
        category: "validation"
        required: false
        nextNodeId: "validate_permissions"
        
      - id: "validate_permissions"
        title: "Permission Validation"
        description: "Validate permissions and access controls"
        type: "BOOLEAN"
        category: "validation"
        required: false
        nextNodeId: "handle_conflicts"
        
      - id: "handle_conflicts"
        title: "Conflict Resolution"
        description: "How to handle existing objects on target"
        type: "SINGLE_SELECT"
        category: "validation"
        required: true
        options:
          - value: "skip"
            label: "Skip Existing"
            description: "Skip objects that already exist on target"
            recommended: true
          - value: "replace"
            label: "Replace Existing"
            description: "Drop and recreate existing objects"
            warningMessage: "This will delete existing objects on the target cluster!"
          - value: "error"
            label: "Error on Conflict"
            description: "Fail migration if conflicts are detected"
        nextPageId: "optimization"

  optimization:
    title: "Optimization Settings"
    description: "Configure optimization settings for metadata operations"
    nodes:
      - id: "optimization_approach"
        title: "Optimization Approach"
        description: "Select optimization strategy for metadata operations"
        type: "SINGLE_SELECT"
        category: "optimization"
        required: true
        options:
          - value: "autoTune"
            label: "Auto Tune (Recommended)"
            description: "Automatically optimize based on metadata characteristics"
            recommended: true
          - value: "batch"
            label: "Batch Processing"
            description: "Process metadata in batches for efficiency"
          - value: "skip"
            label: "Skip Optimizations"
            description: "No optimizations. Use when metadata is already well-organized."
        nextNodeId: "batch_size"
        
      - id: "batch_size"
        title: "Metadata Batch Size"
        description: "Number of objects to process in each batch (Default: 100)"
        type: "NUMBER_INPUT"
        category: "optimization"
        required: false
        dependencies: ["optimization_approach"]
        conditionalLogic: "optimization_approach == 'batch'"
        metadata:
          defaultValue: 100
          min: 10
          max: 1000
        nextNodeId: "optimization_additional"
        
      - id: "optimization_additional"
        title: "Additional Optimization Settings"
        description: "Configure additional optimization options"
        type: "MULTI_SELECT"
        category: "optimization"
        required: false
        options:
          - value: "skipStatsCollection"
            label: "Skip Statistics Collection"
            description: "Skip filesystem statistics gathering for metadata-only migration"
          - value: "parallelProcessing"
            label: "Parallel Processing"
            description: "Process multiple databases in parallel"
          - value: "deferConstraints"
            label: "Defer Constraints"
            description: "Create constraints after all tables are created"
          - value: "optimizeQueries"
            label: "Optimize Queries"
            description: "Optimize metadata extraction queries"
        nextPageId: "execution_mode"

  execution_mode:
    title: "Execution Mode"
    description: "Final execution settings"
    nodes:
      - id: "execution_type"
        title: "Execution Type"
        description: "Choose execution mode"
        type: "SINGLE_SELECT"
        category: "execution"
        required: true
        options:
          - value: "dryRun"
            label: "Dry Run"
            description: "Generate plans without executing (recommended first)"
            recommended: true
          - value: "execute"
            label: "Execute"
            description: "Execute the migration"
            warningMessage: "This will perform the actual migration. Ensure you have tested with dry run first."
        nextNodeId: "execution_options"
        
      - id: "execution_options"
        title: "Execution Options"
        description: "Additional execution settings"
        type: "MULTI_SELECT"
        category: "execution"
        required: false
        options:
          - value: "readOnly"
            label: "Read Only"
            description: "Create tables without PURGE flag"
          - value: "noPurge"
            label: "No Purge"
            description: "Force no PURGE flag"
          - value: "sync"
            label: "Synchronize"
            description: "Synchronize schemas (drop/recreate if different)"
          - value: "resetRight"
            label: "Reset Right"
            description: "DROP CASCADE databases on RIGHT first"
            warningMessage: "This will delete all existing databases on the target cluster!"
          - value: "createDatabaseIfNotExists"
            label: "Create Databases"
            description: "Create target databases if they don't exist"
        nextNodeId: "complete"
        
      - id: "complete"
        title: "Configuration Complete"
        description: "SCHEMA_ONLY strategy configuration is complete"
        type: "PAGE_TRANSITION"
        category: "completion"