# EXPORT_IMPORT Data Strategy Decision Tree
# Purpose: Use Hive's native export/import mechanism for data migration

strategy: "EXPORT_IMPORT"
description: "Use Hive's native export/import mechanism for data migration"

pages:
  connections:
    title: "Connection Selection"
    description: "Select source and target cluster connections"
    nodes:
      - id: "left_connection"
        title: "LEFT Connection"
        description: "Select source cluster connection profile"
        type: "CONNECTION_SELECT"
        category: "connections"
        required: true
        nextNodeId: "right_connection"
        
      - id: "right_connection"
        title: "RIGHT Connection"
        description: "Select target cluster connection profile"
        type: "CONNECTION_SELECT"
        category: "connections"
        required: true
        nextPageId: "general_behavior"

  general_behavior:
    title: "General Behavior"
    description: "Configure basic migration behavior"
    nodes:
      - id: "database_only"
        title: "Database Only Migration"
        description: "Migrate only database definitions, skip tables"
        type: "BOOLEAN"
        category: "general"
        required: false
        nextNodeId: "copy_avro_schemas"
        
      - id: "copy_avro_schemas"
        title: "Copy AVRO Schema Files"
        description: "Copy AVRO schema files between clusters"
        type: "BOOLEAN"
        category: "general"
        required: false
        nextNodeId: "skip_link_check"
        
      - id: "skip_link_check"
        title: "Skip Link Check"
        description: "Skip cluster storage accessibility check"
        type: "BOOLEAN"
        category: "general"
        required: false
        nextPageId: "cluster_connectivity"

  cluster_connectivity:
    title: "Cluster Connectivity"
    description: "Configure storage connectivity for export/import operations"
    nodes:
      - id: "intermediate_storage"
        title: "Intermediate Storage"
        description: "Shared storage location accessible by both clusters for export/import files"
        type: "TEXT_INPUT"
        category: "connectivity"
        required: true
        helpText: "Required for export/import operations. Must be accessible by both source and target clusters."
        nextNodeId: "export_base_dir"
        
      - id: "export_base_dir"
        title: "Export Base Directory"
        description: "Base directory for export files (Default: /tmp/export)"
        type: "TEXT_INPUT"
        category: "connectivity"
        required: false
        metadata:
          defaultValue: "/tmp/export"
        nextPageId: "migration_type"

  migration_type:
    title: "Migration Type Selection"
    description: "Select which types of tables to migrate"
    nodes:
      - id: "acid_migration"
        title: "ACID Tables Migration"
        description: "Configure ACID table migration (Limited Support)"
        type: "SINGLE_SELECT"
        category: "migration"
        required: true
        options:
          - value: "none"
            label: "Skip ACID Tables"
            description: "Do not migrate ACID tables (recommended for export/import)"
            recommended: true
          - value: "include"
            label: "Include ACID Tables (Experimental)"
            description: "Include ACID tables with limitations"
            warningMessage: "ACID tables have limited support in export/import operations"
          - value: "only"
            label: "ACID Tables Only (Experimental)"
            description: "Migrate ONLY ACID tables with limitations"
            warningMessage: "ACID tables have limited support in export/import operations"
        nextNodeId: "acid_options"
        
      - id: "acid_options"
        title: "ACID Table Options"
        description: "Configure ACID table specific settings"
        type: "PAGE_TRANSITION"
        category: "migration"
        dependencies: ["acid_migration"]
        conditionalLogic: "acid_migration != 'none'"
        nextNodeId: "acid_bucket_threshold"
        
      - id: "acid_bucket_threshold"
        title: "Artificial Bucket Threshold"
        description: "Remove bucket definitions if count â‰¤ threshold (Default: 2)"
        type: "NUMBER_INPUT"
        category: "migration"
        required: false
        metadata:
          defaultValue: 2
          min: 1
          max: 100
        nextNodeId: "acid_partition_limit"
        
      - id: "acid_partition_limit"
        title: "ACID Partition Limit"
        description: "Skip ACID tables exceeding this partition count (Default: 500)"
        type: "NUMBER_INPUT"
        category: "migration"
        required: false
        metadata:
          defaultValue: 500
          min: 1
          max: 10000
        nextNodeId: "acid_downgrade"
        
      - id: "acid_downgrade"
        title: "Downgrade ACID Tables"
        description: "Convert ACID to EXTERNAL/PURGE tables"
        type: "BOOLEAN"
        category: "migration"
        required: false
        nextNodeId: "acid_inplace"
        
      - id: "acid_inplace"
        title: "In-place ACID Downgrade"
        description: "Downgrade on same cluster"
        type: "BOOLEAN"
        category: "migration"
        required: false
        dependencies: ["acid_downgrade"]
        conditionalLogic: "acid_downgrade == true"
        nextNodeId: "migrate_views"
        
      - id: "migrate_views"
        title: "Migrate Views"
        description: "Migrate views after underlying tables exist"
        type: "BOOLEAN"
        category: "migration"
        required: false
        nextNodeId: "migrate_non_native"
        
      - id: "migrate_non_native"
        title: "Migrate Non-Native Tables"
        description: "Migrate HBase, Kafka, JDBC tables (Limited Support)"
        type: "BOOLEAN"
        category: "migration"
        required: false
        helpText: "Non-native tables have limited support in export/import operations"
        nextPageId: "export_import_options"

  export_import_options:
    title: "Export/Import Configuration"
    description: "Configure export/import specific settings"
    nodes:
      - id: "export_batch_size"
        title: "Export Batch Size"
        description: "Number of partitions to export in parallel (Default: 4)"
        type: "NUMBER_INPUT"
        category: "export_import"
        required: false
        metadata:
          defaultValue: 4
          min: 1
          max: 50
        nextNodeId: "import_batch_size"
        
      - id: "import_batch_size"
        title: "Import Batch Size"
        description: "Number of import operations to process in parallel (Default: 4)"
        type: "NUMBER_INPUT"
        category: "export_import"
        required: false
        metadata:
          defaultValue: 4
          min: 1
          max: 50
        nextNodeId: "export_compression"
        
      - id: "export_compression"
        title: "Export Compression"
        description: "Enable compression for export files"
        type: "BOOLEAN"
        category: "export_import"
        required: false
        nextNodeId: "export_format"
        
      - id: "export_format"
        title: "Export Format Options"
        description: "Configure export format settings"
        type: "MULTI_SELECT"
        category: "export_import"
        required: false
        options:
          - value: "includeMetadata"
            label: "Include Metadata"
            description: "Include table metadata in export"
            recommended: true
          - value: "includeData"
            label: "Include Data"
            description: "Include table data in export"
            recommended: true
          - value: "preservePermissions"
            label: "Preserve Permissions"
            description: "Preserve table permissions in export"
          - value: "validateExport"
            label: "Validate Export"
            description: "Validate export files before import"
        nextNodeId: "cleanup_policy"
        
      - id: "cleanup_policy"
        title: "Export Cleanup Policy"
        description: "How to handle export files after import"
        type: "SINGLE_SELECT"
        category: "export_import"
        required: true
        options:
          - value: "keep"
            label: "Keep Export Files"
            description: "Keep export files after successful import"
          - value: "delete"
            label: "Delete Export Files"
            description: "Delete export files after successful import"
            recommended: true
          - value: "archive"
            label: "Archive Export Files"
            description: "Move export files to archive location"
        nextPageId: "location_translation"

  location_translation:
    title: "Location Translation Strategy"
    description: "Configure how table locations are translated"
    nodes:
      - id: "translation_type"
        title: "Translation Type"
        description: "Select location translation strategy"
        type: "SINGLE_SELECT"
        category: "location"
        required: true
        options:
          - value: "RELATIVE"
            label: "Relative"
            description: "Simple namespace replacement"
          - value: "ALIGNED"
            label: "Aligned"
            description: "Use warehouse plans for organized layout"
            recommended: true
          - value: "NONE"
            label: "No Translation"
            description: "Keep original locations (same storage accessible from both clusters)"
        nextNodeId: "source_namespace"
        
      - id: "source_namespace"
        title: "Source Namespace"
        description: "Source storage namespace to translate from"
        type: "TEXT_INPUT"
        category: "location"
        required: false
        dependencies: ["translation_type"]
        conditionalLogic: "translation_type != 'NONE'"
        nextNodeId: "target_namespace"
        
      - id: "target_namespace"
        title: "Target Namespace"
        description: "Target storage namespace to translate to"
        type: "TEXT_INPUT"
        category: "location"
        required: false
        dependencies: ["translation_type"]
        conditionalLogic: "translation_type != 'NONE'"
        nextNodeId: "warehouse_config"
        
      - id: "warehouse_config"
        title: "Warehouse Configuration"
        description: "Configure warehouse settings for ALIGNED translation"
        type: "PAGE_TRANSITION"
        category: "location"
        dependencies: ["translation_type"]
        conditionalLogic: "translation_type == 'ALIGNED'"
        nextPageId: "optimization"

  optimization:
    title: "Optimization Settings"
    description: "Configure optimization settings for export/import operations"
    nodes:
      - id: "optimization_approach"
        title: "Optimization Approach"
        description: "Select optimization strategy for export/import operations"
        type: "SINGLE_SELECT"
        category: "optimization"
        required: true
        options:
          - value: "autoTune"
            label: "Auto Tune (Recommended)"
            description: "Automatically optimize based on table characteristics"
            recommended: true
          - value: "sequential"
            label: "Sequential Processing"
            description: "Process tables one at a time for reliability"
          - value: "parallel"
            label: "Parallel Processing"
            description: "Process multiple tables in parallel for speed"
          - value: "skip"
            label: "Skip Optimizations"
            description: "No optimizations. Use when export/import is already optimized."
        nextNodeId: "parallel_degree"
        
      - id: "parallel_degree"
        title: "Parallel Processing Degree"
        description: "Number of parallel export/import operations (Default: 2)"
        type: "NUMBER_INPUT"
        category: "optimization"
        required: false
        dependencies: ["optimization_approach"]
        conditionalLogic: "optimization_approach == 'parallel'"
        metadata:
          defaultValue: 2
          min: 1
          max: 10
        nextNodeId: "optimization_additional"
        
      - id: "optimization_additional"
        title: "Additional Optimization Settings"
        description: "Configure additional optimization options"
        type: "MULTI_SELECT"
        category: "optimization"
        required: false
        options:
          - value: "skipStatsCollection"
            label: "Skip Statistics Collection"
            description: "Skip filesystem statistics gathering for faster operations"
          - value: "buildShadowStatistics"
            label: "Build Shadow Statistics"
            description: "Build statistics on shadow/transfer tables"
          - value: "saveWorkingTables"
            label: "Save Working Tables"
            description: "Keep shadow/transfer tables after migration for debugging"
          - value: "retryFailures"
            label: "Retry Failed Operations"
            description: "Automatically retry failed export/import operations"
          - value: "checkExportIntegrity"
            label: "Check Export Integrity"
            description: "Verify export file integrity before import"
        nextPageId: "execution_mode"

  execution_mode:
    title: "Execution Mode"
    description: "Final execution settings"
    nodes:
      - id: "execution_type"
        title: "Execution Type"
        description: "Choose execution mode"
        type: "SINGLE_SELECT"
        category: "execution"
        required: true
        options:
          - value: "dryRun"
            label: "Dry Run"
            description: "Generate plans without executing (recommended first)"
            recommended: true
          - value: "exportOnly"
            label: "Export Only"
            description: "Perform only the export phase"
          - value: "importOnly"
            label: "Import Only"
            description: "Perform only the import phase (requires existing exports)"
          - value: "execute"
            label: "Execute Full Migration"
            description: "Execute complete export and import migration"
            warningMessage: "This will perform the actual migration. Ensure you have tested with dry run first."
        nextNodeId: "execution_options"
        
      - id: "execution_options"
        title: "Execution Options"
        description: "Additional execution settings"
        type: "MULTI_SELECT"
        category: "execution"
        required: false
        options:
          - value: "readOnly"
            label: "Read Only"
            description: "Create tables without PURGE flag"
          - value: "noPurge"
            label: "No Purge"
            description: "Force no PURGE flag"
          - value: "sync"
            label: "Synchronize"
            description: "Synchronize schemas (drop/recreate if different)"
          - value: "resetRight"
            label: "Reset Right"
            description: "DROP CASCADE databases on RIGHT first"
            warningMessage: "This will delete all existing databases on the target cluster!"
          - value: "continueOnError"
            label: "Continue on Error"
            description: "Continue processing other tables if one fails"
          - value: "rollbackOnFailure"
            label: "Rollback on Failure"
            description: "Rollback partial imports if the operation fails"
        nextNodeId: "complete"
        
      - id: "complete"
        title: "Configuration Complete"
        description: "EXPORT_IMPORT strategy configuration is complete"
        type: "PAGE_TRANSITION"
        category: "completion"